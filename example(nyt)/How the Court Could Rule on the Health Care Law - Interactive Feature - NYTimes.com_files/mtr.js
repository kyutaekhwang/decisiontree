/* $Id: mtr.js 154055 2016-06-09 19:56:06Z krishna.donepudi $ */
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();!function(e){"function"==typeof define&&define.amd?define("auth/gateway/creatives",[],function(){return e()}):"object"==typeof NYTD&&(NYTD.GatewayCreatives=e())}(function(){return{defaultGateway:'<style type="text/css">#overlay.z-index-gateway-overlay{background:linear-gradient(rgba(239,238,238,.4) 0,#efeeee 100%)!important}#gatewayCreative{top:180px!important}.Gateway{position:relative;margin:0 auto;height:445px;width:990px;background:#fff;border:1px solid #eee;-webkit-text-size-adjust:100%;padding:24px;box-sizing:border-box;box-shadow:-10px 10px 50px 15px rgba(0,0,0,.2);text-align:left}.Gateway-Half{width:50%;height:100%;float:left}.Gateway-Two-Thirds{width:60%;height:100%;float:left}.Gateway-One-Third{width:40%;height:100%;float:left}.Gateway-Half{width:50%;height:100%;float:left}.Gateway-Half__Grey{background:#f6f6f6}.Gateway-Embed{padding-top:70px}.Gateway-Content{padding-left:20px;padding-right:20px;margin-left:-5px}.Gateway-Article--Intro,.Gateway-Buttons,.Gateway-Content--Copy,.Gateway-Content--HD,.Gateway-Content--Headline{font-family:nyt-franklin,helvetica,sans-serif}.Gateway-Article--Author,.Gateway-Article--Content,.Gateway-Article--Headline{font-family:nyt-cheltenham,georgia,"times new roman",times,serif}.Gateway-Content--Headline{font-size:31px;line-height:35px;color:#666!important;font-weight:300;margin:0}.Gateway-Content--Headline__Orange{color:#ff6c0f!important}.Gateway-Content--Copy{font-size:17px;color:#000!important;font-weight:300;padding-top:20px}.Gateway-Content--HD{width:252px;margin:0 auto;padding-top:20px;font-size:13px;color:#000}.Gateway-Content--HD a{text-decoration:underline;color:#6087ab}.Gateway-Article{padding-left:28px;padding-right:28px}.Gateway-Article__var{padding-top:39px}.Gateway-Article--Intro{text-align:right;font-size:11px;margin-bottom:19px}.Gateway-Article--Intro strong{text-transform:uppercase}.Gateway-Article--Headline{font-size:24px;line-height:1.1;font-weight:300;color:#000!important}.Gateway-Article--Author{font-size:11px;color:#999;margin:0}.Gateway-Article--Content{margin-left:142px;padding-top:22px;color:#000!important;line-height:1.1}.Gateway-Article--Content__var{margin-left:0}.Gateway-Article--Link:hover,.Gateway-Content--Headline__Orange:hover{text-decoration:none}.Gateway-cf:after,.Gateway-cf:before{content:" ";display:table}.Gateway-cf:after{clear:both}.Gateway-Article--Flag{display:table;width:100%}.Gateway-Article--Flag__content,.Gateway-Article--Flag__img{display:table-cell;vertical-align:middle}.Gateway-Article--Flag__img{padding-right:32px}.Gateway-Article--Flag__img img{display:block;max-width:none;height:110px}.Gateway-Article--Flag__content{width:100%}.Gateway-Pipe{padding:0 5px}.Gateway-Btn{font-size:17px;-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;font-weight:300;display:inline-block;margin-right:18px;text-align:center;text-decoration:none;padding:9px 30px}.Gateway-Btn:last-child{margin-right:0}.Gateway-Btn--Orange{background-color:#ff6c0f}.Gateway-Btn--White{background-color:#f6f6f6;border:1px solid #eee;color:#666!important}.Gateway-Buttons{width:75%;margin:0 auto;margin-top:32px}.Gateway-Buttons-Var{width:61%;margin:0 auto;margin-top:32px}.Gateway-Buttons a{color:#fff}.font-smoothing{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.user-logged-in #login_elements{display:none}#login_elements{display:inline-block}@media only screen and (max-width :990px){.Gateway{width:568px;height:724px}.Gateway-Whole-Top{width:100%;height:55%}.Gateway-Whole-Bottom{width:100%;height:45%}.Gateway-Embed{padding-top:40px}.has-fontface .Gateway-Content--HD{font-size:13px}.Gateway-Content--HD{color:#000;position:absolute;top:20px;right:0;padding-top:0}.has-fontface .Gateway-Content--Headline{font-size:38px}.Gateway-Content--Headline{font-size:36px}.has-fontface .Gateway-Content--Copy{font-size:20px}.Gateway-Content--Copy{font-size:19px}.has-fontface .Gateway-Article--Content{font-size:18px}.Gateway-Article--Content{margin-left:0;font-size:16px}.Gateway-Article--Flag__img img{height:100px}.Gateway-Buttons{width:67%}}</style><div id="gw-bg"><div class="Gateway Gateway-cf"><div class="Gateway-Whole-Top Gateway-Half"><div class="Gateway-Embed Gateway-Content font-smoothing"><h2 class="Gateway-Content--Headline">To read this article and more,</h2><a target="_blank" href="http://www.nytimes.com/subscriptions/Multiproduct/lp3826.html?campaignId=47YF8" data-content-collection="GWtoDSLP" data-content-collection="GWtoDSLP" class="Gateway-Content--Headline Gateway-Content--Headline__Orange">subscribe now &mdash;<br>just 99&cent; for 4 weeks.</a><p class="Gateway-Content--Copy">You&#8217;ve already read your 10 free articles for the month.<br>To continue reading, without interruption, subscribe and<br>get unlimited digital access to The Times.</p><div class="Gateway-Buttons"><a target="_blank" href="http://www.nytimes.com/subscriptions/Multiproduct/lp3826.html?campaignId=47YF8" data-content-collection="GWtoDSLP" class="Gateway-Btn Gateway-Btn--Orange">See My Options</a> <a href="https://myaccount.nytimes.com/auth/login" id="login_elements" class="Gateway-Btn Gateway-Btn--White sitewideLogInModal login-modal-trigger">Log In</a></div><div class="Gateway-Content--HD"><span class="Gateway-Content--HD__copy">Home Delivery Subscribers&nbsp;</span><a target="_blank" href="https://myaccount.nytimes.com/link/homedelivery" data-content-collection="GWtoHDLP">Link Account</a></div></div></div><div class="Gateway-Whole-Bottom Gateway-Half Gateway-Half__Grey"><div class="Gateway-Embed Gateway-Article"><div class="Gateway-Article--Intro"><strong>U.S.</strong><span class="Gateway-Pipe">&#124;</span><span>Feb. 5, 2015</span></div><a class="Gateway-Article--Link" target="_blank" href="http://www.nytimes.com/subscriptions/Multiproduct/lp3826.html?campaignId=47YF8" data-content-collection="GWtoDSLP"><div class="Gateway-Article--Container Gateway-Article--Flag"><div class="Gateway-Article--Image Gateway-Article--Flag__img"><img src="https://static01.nyt.com/subscriptions/GW/nyt_thumb.png"></div><div class="Gateway-Article--Flag__content"><h3 class="Gateway-Article--Headline">A Veteran Works to Break the Broken Hero Stereotype</h3><p class="Gateway-Article--Author">By Dave Philipps</p></div></div><p class="Gateway-Article--Content">Chris Marvin, a retired Army pilot, has started a program to grade television shows and movies on how fairly and accurately they portray military veterans.</p></a></div></div></div></div><script src="https://static01.nyt.com/marketing/ADX/testing/gwyEmbedded.js"></script>',defaultGrowl:{ads:{Left9:{campaign:"default_growl",campaignId:"001",campaignName:"default_growl",classification:"Growl",creative:'<style>#growl-container{margin-bottom:-163px;padding:0;width:430px;height:280px;position:fixed;left:0;bottom:0;z-index:1000000100;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;background:url(https://static01.nyt.com/subscriptions/growl/CRS-9326_430x280_bg_growl_2x.png) no-repeat 0 0;background-size:430px 280px;background-color:#d7e67d}a#growl-cta10,a#growl-cta5,a#growl-cta9{margin:0;padding:0;width:91px;height:280px;position:absolute;left:0;bottom:-8px;z-index:1000000100}a#growl-cta10,a#growl-cta5,a#growl-cta9{display:none}#growl-artcopy{position:absolute;top:0;left:0;width:430px;height:23px;font-size:10px;font-family:nyt-franklin,\'Helvetica Neue\',Arial,sans-serif;font-weight:700;background-color:#000;color:#fff;text-align:center}#growl-countwrap{position:relative;top:6px}#growl-close{position:absolute;right:4px;top:4px;width:15px;height:15px;z-index:1000000101}#growl-close img{width:15px;height:15px}#growl-headline{position:absolute;top:51px;left:44px;font-family:nyt-franklin,\'helvetica neue\',arial,sans-serif;font-size:14.5px;line-height:16px;color:#000;font-weight:500;width:260px}#growl-headline span{font-weight:300}#growl-subhdr{position:absolute;top:154px;left:44px;color:#000;font-family:nyt-karnak-display-130124,sans-serif;font-size:26px;line-height:29px}#growl-cta{position:absolute;top:40px;right:18px;width:91px;height:30px;border-radius:3px;transition:background-color .3s;font-family:nyt-franklin,\'helvetica neue\',arial,sans-serif;font-weight:700;background:#000;font-size:11px;padding:0;text-align:center;text-decoration:none}#growl-cta a{height:100%;cursor:pointer;color:#fff;text-decoration:none;text-transform:uppercase;padding-top:9px}.show-cta{display:block!important;width:91px;height:280px;pointer:cursor}.adx-info,.hidden{display:none}</style><div id="growl-container"class="nytdGrowlUIContainer mtr-default"data-campaign-id-m5="4YRL6"data-campaign-id-m9="4YRL8"data-campaign-id-m10="4YRLF"><div id="growl-artcopy"><span id="growl-countwrap"><span class="growl_art"></span></span></div><div id="growl-close"><a href="javascript:;"class="nytdGrowlNotifyCross"><img src="https://static01.nyt.com/subscriptions/growl/icon-growl-close.png"alt="Close"></a></div><div id="growl-body"><div id="growl-headline"><span>Get 4 weeks of The Times.</span> Just 99&cent;.</div><div id="growl-subhdr">Real news deserves real journalism.</div><div id="growl-cta"><a href="http://www.nytimes.com/subscriptions/Multiproduct/lp3826.html?campaignId=4WUJF"data-content-collection="GrowltoDSLP"target="_blank"id="growl-cta5">Start now</a> <a href="http://www.nytimes.com/subscriptions/Multiproduct/lp3826.html?campaignId=4WUK8"data-content-collection="GrowltoDSLP"target="_blank"id="growl-cta9">Start now</a> <a href="http://www.nytimes.com/subscriptions/Multiproduct/lp3826.html?campaignId=4WUKF"data-content-collection="GrowltoDSLP"target="_blank"id="growl-cta10">Start now</a></div></div><script src="https://typeface.nytimes.com/zam5nzz.js"></script><script>try{Typekit.load();}catch(e){}</script><img src="https://beacon.krxd.net/event.gif?event_id=IEOB-3CP&amp;event_type=cact"alt=""class="hidden"><div id="mkt-floodlight-growl"></div><script src="https://static01.nyt.com/marketing/abTest/addfloodlight_growl.js"></script></div>',creativeId:0,height:"120",isDirectlySold:"true",isInlineSafe:"Y",paid_post_tracking_url:"",paid_post_url:"",priority:"9000",width:"120"}},isDefault:!0}}}),function(e){"function"==typeof define&&define.amd?define("ecomm/url",["jquery/nyt"],function(t){return e(t)}):"object"==typeof NYTD&&(NYTD.Ecomm=NYTD.Ecomm||{},NYTD.Ecomm.Url=e(NYTD.jQuery||window.jQuery))}(function(e){return{parseUri:function(e){var t=e;("string"!=typeof t||null===t.match(/http|http/gim))&&(t="");for(var a={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=a.parser[a.strictMode?"strict":"loose"].exec(t),o={},i=14;i--;)o[a.key[i]]=n[i]||"";return o[a.q.name]={},o[a.key[12]].replace(a.q.parser,function(e,t,n){t&&(o[a.q.name][t]=n)}),o},parseCurrentUri:function(){return this.parseCurrentUri.result||(this.parseCurrentUri.result=this.parseUri(this.getLocationHref())),this.parseCurrentUri.result},getLocationHref:function(){return location.href},getParameter:function(e){var t=this.parseCurrentUri();return t.queryKey[e]},appendParamsToUrl:function(t,a){if(!t)return null;if(!a||"object"!=typeof a||a instanceof Array)return t;var n=void 0,o=void 0,i=void 0,r={},c=t;return c.indexOf("#")>-1&&(n=c.split("#"),c=n[0]),c.indexOf("?")>-1?(o=c.split("?"),i=o[0],r=this.parseUri(c).queryKey):i=c,r=e.extend({},r,a),i+"?"+e.param(r)+(n?"#"+n[1]:"")},updateQueryStringParameter:function(e,t,a){if(!e||"string"!=typeof e)return null;if(!t||"string"!=typeof t||"string"!=typeof a)return e;var n=new RegExp("([?|&])"+t+"=.*?(&|$)","i"),o=void 0,i=-1!==e.indexOf("?")?"&":"?";return o=e.match(n)?e.replace(n,"$1"+t+"="+a+"$2"):e+i+t+"="+a},getDomain:function(e){var t="string"==typeof e?e:"",a=t.match(/^https?\:\/\/([^\/:?#]+)(?:[\/:?#]|$)/i);return a?a[1]:void 0},getAdxKeywords:function(){var e=[],t=this.getParameter("smid"),a=this.getParameter("mtrref"),n=this.getDomain(document.referrer);return t&&""!==t&&e.push(t),a&&""!==a&&-1===a.indexOf("nytimes")&&e.push("mtr_"+a),n&&-1===n.indexOf("nytimes")&&e.push("mtr_"+n),e.join(",")},processUrlHref:function(t,a){if(!(t instanceof e)||"object"!=typeof a)return!1;var n=t.attr("href");if(!n||n.match(/^javascript:/i)||n.match(/^mailto:/i)||n.match(/^tel:/i)||n.match(/#/))return!1;var o=n.match(/[?|&]goto=([^;]+)/),i=o&&o[1]||null;i?(i=decodeURIComponent(i),i=encodeURIComponent(decodeURIComponent(this.appendParamsToUrl(i,a))),n=this.updateQueryStringParameter(n,"goto",i)):n=this.appendParamsToUrl(n,a),t.attr("href",n)}}}),function(e){"function"==typeof define&&define.amd?define("ecomm/cookies",[],function(){return e()}):"object"==typeof NYTD&&(NYTD.Ecomm=NYTD.Ecomm||{},NYTD.Ecomm.Cookies=e())}(function(){return{getMeterCookieCount:function(){var e=this.getDocumentCookies().match(/v=i.([0-9]+)/);return e?e[1]:!1},get:function(e){return new RegExp(e+"=([^;]+)","i").test(window.decodeURIComponent(this.getDocumentCookies()))?RegExp.$1:null},set:function(e,t,a){var n=new Date;n.setTime(n.getTime());var o=a;o&&(o=1e3*o*60*60*24);var i=new Date(n.getTime()+o),r=e+"="+t+";path=/"+(o?";expires="+i.toGMTString():"")+";domain=.nytimes.com";this.setDocumentCookies(r)},remove:function(e,t,a,n){var o=e+"=xxx"+(t?";path="+t:";path=/")+(a?";domain="+a:";domain=.nytimes.com")+(n?";secure":"")+"; expires=Thu, 01 Jan 1970 00:00:01 GMT;";this.setDocumentCookies(o)},getDocumentCookies:function(){return document.cookie},setDocumentCookies:function(e){document.cookie=e},setOrRemoveMtrabCookie:function(e){e&&null!==e.variation&&null!==e.name?this.set("mtrab",e.name+e.variation):this.remove("mtrab")}}}),function(e){"function"==typeof define&&define.amd?define("ecomm/logger",["ecomm/url","ecomm/cookies"],function(t,a){return e(t,a)}):"object"==typeof NYTD&&(NYTD.Ecomm=NYTD.Ecomm||{},NYTD.Ecomm.Logger=e(NYTD.Ecomm.Url,NYTD.Ecomm.Cookies))}(function(e,t){var a=void 0,n=function(){function n(){_classCallCheck(this,n),this.debugQueryString=e.getParameter("debug"),this.debugCookie=t.get("mtr-debug")}return _createClass(n,[{key:"getConsole",value:function(){return window.console}},{key:"isDebugMode",value:function(){return!(!this.debugCookie&&void 0===this.debugQueryString)}},{key:"log",value:function(e){return"string"==typeof e&&""!==e&&this.isDebugMode()?(this.getConsole().log(e),!0):!1}}],[{key:"getInstance",value:function(){return void 0===a&&(a=new n,a.constructor=null),a}}]),n}();return n}),function(e){if("function"==typeof define&&define.amd)define("ecomm/utils",["jquery/nyt","ecomm/logger","ecomm/url"],function(t,a,n){var o=a.getInstance();return e(t,"NYT5",o,n)});else if("object"==typeof NYTD){var t=NYTD.Ecomm.Logger.getInstance();NYTD.Ecomm=NYTD.Ecomm||{},NYTD.Ecomm.Utils=e(NYTD.jQuery||window.jQuery,"NYT4",t,NYTD.Ecomm.Url)}}(function(e,t,a,n){var o={setToLocalStorage:function(e,t){return this.hasLocalStorage()?void this.getLocalStorage().setItem(e,t):!1},hasLocalStorage:function(){if(/MSIE\s8\.0/.test(this.getUserAgent()))return!1;try{return void 0!==this.getLocalStorage()}catch(e){return!1}},getFromLocalStorage:function(e){try{return this.hasLocalStorage()&&this.getLocalStorage().getItem(e)}catch(t){return!1}},getFilteredObject:function(t,a){var n={};return t&&a?(e.each(t,function(t,o){e.inArray(t,a)>-1&&(n[t]=o)}),n):n},getLink:function(e){return e.is("a")?e:e.parents("a").eq(0)},isHrefValid:function(e){var t=this.getLink(e).attr("href"),a=/^javascript:|^#|^mailto:/gim,n=!0;return(!t||t.match(a))&&(n=!1),n},runWhenReady:function(e,t,a,n){var o=n||5;setTimeout(function i(){e()?t():--o&&setTimeout(i,a)},a)},pageType:function(){var t=e("meta[name='PT']")[0];return t=t&&t.content||"",t.replace(/ /g,"")},getLocalStorage:function(){return window.localStorage},getUserAgent:function(){return navigator.userAgent},getLocation:function(){return window.location},isNYT5Env:function(){var e=document.getElementsByName("sourceApp"),t={"nyt-v5":!0,blogs:!0};return"undefined"!=typeof e[0]&&e[0].getAttribute("content")in t},parseAds:function(t){var n="",o="",i={adxCampaigns:n,creatives:o};return t&&t.ads&&(e.each(t.ads,function(e,t){t.campaign&&(n+=t.campaign),o+=t.creative}),i={adxCampaigns:n,creatives:o},a.log(i)),i},appendAds:function(t,a){var n=this.parseAds(t),o=a&&a instanceof e&&a.length>0?a:e("body");return o.append(n.creatives),n.adxCampaigns},debounce:function(e,t){var a=null;return function(){var n=this,o=arguments;clearTimeout(a),a=setTimeout(function(){e.apply(n,o)},t)}},getNytVersion:function(){return t},isSlideShowApp:function(){return e("html").hasClass("app-slideshow")},checkStringWithRegexp:function(e,t){if(!e||!t)throw new Error("checkStringWithRegexp(): both params should be specified");if("string"!=typeof t||"string"!=typeof e)throw new TypeError("checkStringWithRegexp(): use string as both parameters");var a=new RegExp(e,"i");return a.test(t)},fillBackupCookieList:function(){var e=[this.getFromLocalStorage("nyt-m"),window.name],t=e.filter(function(e){return!("string"!=typeof e||""===e)});return t},removeGatewayHash:function(){var e=this.getLocation(),t=e.href.replace(/(\?|&)(gwh|gwt)=([^&]+)/gi,"");return e.replace(t),t},addGatewayHash:function(e,t,a){var o="";if(!e)return o;var i=this.getLocation(),r=t?"pay":"regi",c=window.decodeURIComponent(i.href).split("#");c=c.length>1?"#"+c[1]:null;var s=a?"&assetType="+a:"",l="mtrref="+n.getDomain(document.referrer)+"&gwh="+e+"&gwt="+r+s;return o=i.search?i.href+"&"+l:i.href+"?"+l,o=c?o.replace(c,"")+c:o,i.replace(o),o},getGatewayHashFromUri:function(){var e=window.decodeURIComponent(this.getLocation().search);return/gwh=([^&]+)/.test(e)?RegExp.$1:""},cleanUrlFromQueryAndHashes:function(){return this.getLocation().href.replace(/\b(\?|\#).+/g,"")},onEscapeKey:function(e){27===e.keyCode&&e.preventDefault()},getGatewayType:function(){var e=window.decodeURIComponent(this.getLocation().search),t=/gwt=([^&]+)/.test(e)?RegExp.$1:"";return"regi"===t?"regi":"pay"}};return o}),function(e){"function"==typeof define&&define.amd?define("ecomm/etTracker",["jquery/nyt","ecomm/utils","ecomm/url","ecomm/cookies"],function(t,a,n,o){return e(t,a,n,o)}):"object"==typeof NYTD&&(NYTD.Ecomm=NYTD.Ecomm||{},NYTD.Ecomm.EtTracker=e(NYTD.jQuery||window.jQuery,NYTD.Ecomm.Utils,NYTD.Ecomm.Url,NYTD.Ecomm.Cookies))}(function(e,t,a,n){var o=function(){function o(e){_classCallCheck(this,o),this.config=e,this.$container=e.$container,this.module=e.module,this.region=e.region,this.meterCount=e.meterCount||o.getMeterPageCount(),this.adxCampaignName=e.adxCampaignName||"",this.skipAnchorTracking=e.skipAnchorTracking||!1,e.isInTest||(this.init(e),this.updateAnchorETParamsHandler())}return _createClass(o,[{key:"init",value:function(a){this.moduleInteractions=[{selector:".login-modal-trigger",tagxEvent:"login-click",action:"click",etParamKey:"modalLogin"},{selector:".registration-modal-trigger",tagxEvent:"regi-click",action:"click",etParamKey:"modalRegi"}],this.trackingParams={common:{version:"meter at "+this.meterCount,module:this.module,pgtype:t.pageType,region:this.region,contentId:this.adxCampaignName,mediaId:this.getMediaId(),referrer:document.referrer,priority:!0},load:{action:"Impression",eventName:"Impression"},close:{action:"click",eventName:"Dismiss"+this.module},modalRegi:{module:this.module+"-Regi",action:"click",eventName:"regi-click"},modalLogin:{module:this.module+"-Login",action:"click",eventName:"login-click"},links:{module:this.module+"-Links",action:"click",contentCollection:this.module.toLowerCase()+"-links-click"}},this.trackingParams=e.extend(!0,{},this.trackingParams,a.trackingParams),this.moduleInteractions=this.moduleInteractions.concat(a.moduleInteractions||[]),this.record(this.module.toLowerCase()+"-load",e.extend({},this.trackingParams.common,this.trackingParams.load),"impression"),this.skipAnchorTracking||this.setAnchorTracking(),this.setupModuleInteractions()}},{key:"updateAnchorETParamsHandler",value:function(){var t=this;e(document).on(this.module+".updateAnchorETParams",function(){t.addAnchorTracking(t.$container,t.trackingParams)})}},{key:"getMediaId",value:function(){var t=e.trim(this.$container.find(".adxInfo").text()),a="";return t&&/creative:/.test(t)&&(a=t.replace(/.*creative:\s([^,]*).*/,"$1"),a=a.indexOf(" -- ")?e.trim(a.split(" -- ")[0]):a),a}},{key:"setupModuleInteractions",value:function(){for(var e=this,t=this.moduleInteractions||[],a=[],n=0;n<t.length;n++){var o=t[n].action;"click"===o&&(this.moduleInteractions[n].action="mouseup",o="mouseup"),-1===a.indexOf(o)&&a.push(o)}a.forEach(function(t){e.listenTo(t)})}},{key:"listenTo",value:function(e){var t=this;this.$container.on(e,function(e){t.handle(e)})}},{key:"isSelector",value:function(e,t){return e.is(t)||!!e.parents(t).length}},{key:"handle",value:function(t){for(var a=0;a<this.moduleInteractions.length;a++){var n=this.moduleInteractions[a],o=e(t.target);if(this.isSelector(o,n.selector)&&n.action===t.type){var i=3===t.which;i||(this.track(n.tagxEvent,n.etParamKey),n.callback&&"function"==typeof n.callback&&n.callback(t))}}}},{key:"setAnchorTracking",value:function(){var t=this;this.addAnchorTracking(this.$container,this.trackingParams),e(document).on(this.module+".updateAnchorETParams",function(){t.addAnchorTracking(t.$container,t.trackingParams)})}},{key:"addAnchorTracking",value:function(t,a){var n=this;if(!(t instanceof e)||"object"!=typeof a)throw new Error("Please specify both params with correct types and values");t.find("a").each(function(e,t){n.processLinks(t,a)})}},{key:"processLinks",value:function(n,o){if(!n||!o||"object"!=typeof n||"object"!=typeof o)throw new Error("Please specify both params with correct types and values");var i=e(n),r=o;if(t.isHrefValid(i)){var c=t.getFilteredObject(i.data(),["contentCollection","contentPlacement"]),s=e.extend({},r.common,r.links,c);a.processUrlHref(i,s)}}},{key:"track",value:function(t,a,n){var o=this.trackingParams||{},i=e.extend({},o.common||{},o[a],n||{});this.record(t,i,"interaction")}},{key:"trackMeterUpdate",value:function(e){this.record("nytd:meter:viewedCountUpdated",{v:e})}},{key:"record",value:function(e,a,n){t.runWhenReady(function(){return"TAGX"in window},function(){TAGX.EventProxy.trigger(e,a,n)},1e3,10)}}],[{key:"getMeterPageCount",value:function(){var e=n.get("nyt-m")||t.getFromLocalStorage("nyt-m")||window.name||"",a=e.match(/v=i\.([0-9]+)/);return a&&a[1]?parseInt(a[1],10):null}}]),o}();return o}),function(e){"function"==typeof define&&define.amd?define("ecomm/overlay",["jquery/nyt","ecomm/utils"],function(t,a){return e(t,a)}):"object"==typeof NYTD&&(NYTD.Ecomm.Overlay=e(NYTD.jQuery||window.jQuery,NYTD.Ecomm.Utils))}(function(e,t){var a=function(){function a(){_classCallCheck(this,a),this.imageHost=window.location.host.indexOf(".stg.")>0?"https://static.stg.nytimes.com":"https://static01.nyt.com"}return _createClass(a,[{key:"add",value:function(){var t=a.getCreative();a.display(t,function(){var t=void 0!==document.body.style.webkitTransition||void 0!==document.body.style.MozTransition||void 0!==document.body.style.OTransition||void 0!==document.body.style.msTransition,n=function(){e("#overlay").css("height",a.getGatewayHeight())};e(window).on("resize",function(){n()}),t||e("#overlay").css("background-image","url("+this.imageHost+"/images/global/backgrounds/transparentBG.gif)"),n(),a.blockContent()})}}],[{key:"getCreative",value:function(){var e=void 0,a=t.isSlideShowApp();return"NYT5"!==t.getNytVersion()||a?("NYT4"===t.getNytVersion()||a)&&(e="<div id=\"overlay\" style=\"\n                    z-index:1000;\n                    background: transparent;\n                    background:-moz-linear-gradient(center bottom , #000, transparent);\n                    background:-ms-linear-gradient(top, transparent, black);\n                    background: -webkit-gradient(linear, left bottom, left top, from(#000), to(transparent));\n                    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#00000010', endColorstr='#000000');\n                    position:fixed; width:100%; height:0; bottom:0; left:0; display: none\">\n                    </div>"):e='<div id="overlay" class="z-index-gateway-overlay" style="\n                    visibility: visible;\n                    background: transparent;\n                    background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIwLjQiLz4KICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgPC9saW5lYXJHcmFkaWVudD4KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMSIgaGVpZ2h0PSIxIiBmaWxsPSJ1cmwoI2dyYWQtdWNnZy1nZW5lcmF0ZWQpIiAvPgo8L3N2Zz4=);\n                    background: -moz-linear-gradient(top, rgba(255,255,255,0.4) 0%, rgba(255,255,255,1) 100%); /* FF3.6+ */\n                    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(255,255,255,0.4)), color-stop(100%,rgba(255,255,255,1))); /* Chrome,Safari4+ */\n                    background: -webkit-linear-gradient(top, rgba(255,255,255,0.4) 0%,rgba(255,255,255,1) 100%); /* Chrome10+,Safari5.1+ */\n                    background: -o-linear-gradient(top, rgba(255,255,255,0.4) 0%,rgba(255,255,255,1) 100%); /* Opera 11.10+ */\n                    background: -ms-linear-gradient(top, rgba(255,255,255,0.4) 0%,rgba(255,255,255,1) 100%); /* IE10+ */\n                    background: linear-gradient(to bottom, rgba(255,255,255,0.4) 0%,rgba(255,255,255,1) 100%); /* W3C */\n                    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr=\'#66ffffff\', endColorstr=\'#ffffff\',GradientType=0 ); /* IE6-8 */\n                    position:fixed; width:100%; height:0; bottom:0; left:0; display: none">\n                    </div>',e}},{key:"getReferenceForClickableArea",value:function(){var t=e(".gateway-anchor").first(),a=e("#masthead"),n=e("#slideshow-header"),o=a.find(".container").first(),i=e(".navigation").first(),r=i.next(".subNavigation");return t.length>0?t:o.length>0?o:n.length>0?n:r.length>0?r:i.length>0?i:a.length>0?a:e(document.body)}},{key:"getGatewayHeight",value:function(){var t=a.getReferenceForClickableArea(),n=void 0;return n=null===t.offset()?"70%":e(window).height()-(t.offset().top+t.outerHeight(!0))}},{key:"display",value:function(t,n){return document.body&&document.body.firstChild?(e("body").append(t),void(n&&n())):void setTimeout(function(){a.display(t,n)},100)}},{key:"stopScrolling",value:function(){window.scroll(0,0),e("body").css({overflow:"hidden",margin:"0 0 85px 0","padding-right":"15px"}),e("html").css({overflow:"hidden"}),e(document).off("keypress keydown keyup touchmove"),e(document).on("keypress keydown keyup",function(e){return e.keyCode in{37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",36:"HOME",35:"END",33:"PAGEUP",34:"PAGEDOWN"}?(e.preventDefault(),!1):void 0}),e(document).on("touchmove",function(e){e.preventDefault()}),window.Event&&"function"==typeof Event.stopObserving&&(Event.stopObserving(document,"keydown"),Event.stopObserving(document,"keyup"),Event.stopObserving(document,"keypress"),Event.stopObserving(window,"keydown"),Event.stopObserving(window,"keyup"),Event.stopObserving(window,"keypress"))}},{key:"removeNYTClean",value:function(){e("script").each(function(){return e(this).attr("src")&&e(this).attr("src").toLowerCase().indexOf("euri.ca")>0?(window.location.reload(),!1):void 0})}},{key:"blockContent",value:function(){var e=function(){a.stopScrolling(),a.removeNYTClean(),a.scrap()};e(),setInterval(e,1e3)}},{key:"scrap",value:function(){e(["#article .articleInline","#article #readerscomment","#article .articleFooter","#article .authorIdentification","#article #articleExtras","#article .articleBottomExtra","#article .emailAlertModule","#article #pageLinks","#twitter-widget-0",".videoplayerContainer","iframe",".slideShowModule","#subscribeCallToAction","#story figure"].join(",")).not("figure.layout-horizontal-full-bleed").remove(),e(["#article .articleBody p","#content .entry-content p","#content .postContent p","#story .story-body-text"].join(",")).each(function(t,a){var n=1,o=e(a);if(0===t){var i=o.html();i.length&&i.length<400&&(n=2)}if(t===n){var r=e('<p id="subscribeCallToAction" style="text-align: center; margin-top: 28px; font-family: arial,helvetica,sans-serif; font-size: 1.2em; font-weight: bold;"><a  data-content-collection="GWtoDSLP" data-content-placement="1" class="applicationButtonLt" href="https://www.nytimes.com/articlegate" style="width: 250px; padding: 7px 25px !important; font-weight: bold; color: #004276; text-decoration: none"><span>To see the full article, subscribe here.</span></a></p>');r.insertAfter(o)}else t>n&&o.remove()})}}]),a}();return a}),function(e){"function"==typeof define&&define.amd?define("auth/gateway",["jquery/nyt","auth/gateway/creatives","ecomm/utils","ecomm/cookies","ecomm/url","ecomm/overlay","ecomm/etTracker","ecomm/logger"],function(t,a,n,o,i,r,c,s){return e(t,a,n,o,i,r,c,s)}):"object"==typeof NYTD&&(NYTD.Gateway=e(NYTD.jQuery||window.jQuery,NYTD.GatewayCreatives,NYTD.Ecomm.Utils,NYTD.Ecomm.Cookies,NYTD.Ecomm.Url,NYTD.Ecomm.Overlay,NYTD.Ecomm.EtTracker,NYTD.Ecomm.Logger))}(function(e,t,a,n,o,i,r,c){var s=function(){function s(e,t){_classCallCheck(this,s),this.wwwHost="https://www.nytimes.com",this.edition=this.getNYTEdition(),this.wallType=e,this.assetType=t,this.etTracker=null,this.timeout=5e3,this.isDefaultLoaded=!1,this.debugFlag=1&c.getInstance().isDebugMode()}return _createClass(s,[{key:"getNYTEdition",value:function(){return window.decodeURIComponent(n.getDocumentCookies()).match(/NYT-Edition=([^;]+)/)}},{key:"showGateway",value:function(e){var t=void 0,n=this;return n.isDefaultLoaded?!1:e&&e.ads&&"object"==typeof e.ads.Gateway?(window.NYTD=window.NYTD||{},NYTD.Gateway=NYTD.Gateway||{},NYTD.Gateway.etAdxInfo={},t=a.parseAds(e),n.displayCreatives(t.creatives,t.adxCampaigns),!0):(n.showDefaultCreative(),!1)}},{key:"showDefaultCreative",value:function(){return this.isDefaultLoaded=!0,this.displayCreatives(t.defaultGateway)}},{key:"addCreative",value:function(){var t=this;e.ajax({url:t.wwwHost+"/adx/bin/adxrun.html?jsonp=?",dataType:"jsonp",data:{v:3,page:this.getAdxSetupUrl(),positions:"Gateway,data_country,data_currency,data1,data2,data3",keywords:o.getAdxKeywords(),debug:this.debugFlag},success:function(e){t.showGateway(e)},error:function(){t.showDefaultCreative()},timeout:t.timeout})}},{key:"displayCreatives",value:function(t,n){if(!t||"string"!=typeof t)throw new Error("please specify correct adCreatives parameter");var o=new i,c=this;o.add();var l="width:100%; position:fixed; bottom: 80px; display: none; left:0;";"NYT4"===a.getNytVersion()&&(l+=" z-index: 1000000040;");var d=['<div id="gatewayCreative" class="z-index-gateway-overlay" style="'+l+'">','<div id="gatewayUnit" style="position:relative">'].concat(t).concat(["</div>","</div>"]).join(""),u=function(e){var t={$container:e,module:"Gateway",region:"FixedCenter",trackingParams:{common:{contentId:n
}}};c.etTracker=new r(t)},g=function(){setTimeout(function(){var t=e("#gatewayCreative");u(t),e("#overlay").fadeIn(),t.fadeIn()},200)};s.appendToBody(d,g)}},{key:"getAdxSetupUrl",value:function(){var e=void 0,t=this.edition,a=!(!t||"edition|GLOBAL"!==t[1]),n=a?"-global":"",o=this.assetType?"_"+this.assetType:"";return e="pay"===this.wallType?"gateway"+n+o+".nytimes.com":"regiwall"+n+".nytimes.com"}}],[{key:"appendToBody",value:function(t,a){if(!t||"string"!=typeof t)throw new Error("appendToBody(): Specify correct html content to add");document.body?(e("body").append(t),"function"==typeof a&&a()):setTimeout(function(){s.appendToBody(t,a)},100)}}]),s}();return s}),function(e){"function"==typeof define&&define.amd?define("auth/gateway-d",["jquery/nyt","ecomm/utils","ecomm/etTracker","ecomm/logger"],function(t,a,n,o){return e(t,a,n,o)}):"object"==typeof NYTD&&(NYTD.DismissibleGW=e(NYTD.jQuery||window.jQuery,NYTD.Ecomm.Utils,NYTD.Ecomm.EtTracker,NYTD.Ecomm.Logger))}(function(e,t,a,n){var o=function(){function o(e){_classCallCheck(this,o),this.meter=e}return _createClass(o,[{key:"initialize",value:function(){var t=this,a=1&n.getInstance().isDebugMode();e.ajax({url:"https://www.nytimes.com/adx/bin/adxrun.html?v=3&jsonp=?",dataType:"jsonp",data:{page:"softwall.nytimes.com",positions:"Gateway,data_country,data_currency,data1,data2,data3",debug:a},success:function(e){t.onLoadEventHandler(e)}})}},{key:"onLoadEventHandler",value:function(e){return e&&e.ads?(window.NYTD=window.NYTD||{},NYTD.Gateway=NYTD.Gateway||{},NYTD.Gateway.etAdxInfo={},this.adData=t.parseAds(e),this.addCreative(),void this.setTracking()):!1}},{key:"addCreative",value:function(){if(!this.adData.creatives)throw new Error("creatives is not set yet");var t='<div id="gateway-d">'+this.adData.creatives+"</div>";e("body").append(t),this.$container=e("#gateway-d")}},{key:"setTracking",value:function(){var e=this;this.etTracker=new a({$container:this.$container.find("#gw-wrapper"),module:"DismissibleGateway",adxCampaignName:this.adData.adxCampaignName,region:"FixedCenter",meterCount:this.meter.pageCount,anchorPrefix:"dgateway-",moduleInteractions:[{selector:".gw-modal-close",action:"click",tagxEvent:"gateway-dismiss",etParamKey:"close",callback:function(){e.$container.fadeOut(100)}}]})}}]),o}();return o}),function(e){if("function"==typeof define&&define.amd)define(["jquery/nyt","auth/gateway","auth/gateway-d","ecomm/utils","ecomm/url","ecomm/cookies","ecomm/etTracker"],function(t,a,n,o,i,r,c){return e(t,a,n,o,i,r,c)});else if("object"==typeof NYTD){var t=NYTD;t.Meter=e(t.jQuery||window.jQuery,t.Gateway,t.DismissibleGW,t.Ecomm.Utils,t.Ecomm.Url,t.Ecomm.Cookies,t.Ecomm.EtTracker)}}(function(e,t,a,n,o,i,r){var c=[],s=void 0,l=function(){function o(){_classCallCheck(this,o),this.meterCookieBackupPriorityList=n.fillBackupCookieList(),this.meterSvc="https://meter-svc.nytimes.com/meter.js?callback=?",this.currentCleanUrl=n.cleanUrlFromQueryAndHashes(),window.NYT_meterBackupCallback=o.meterBackupCallback,this.prevMeterCount=o.getMeterPagesCount(),this.etTracker=new r({$container:e("body"),module:"meter",skipAnchorTracking:!0})}return _createClass(o,[{key:"init",value:function(){var t=this;if(e(document).on("popstate",function(){t.onUrlChange()}),o.isErrorPage())return e(document).off("keydown",n.onEscapeKey),!1;var a=n.getGatewayHashFromUri(),i=o.getCookieHash();o.processMeterCookie()?a?a&&!i||a!==i?n.removeGatewayHash():a&&i&&a===i&&(t.loadGateway(),t.updateUserState()):t.checkMeter():t.loadCookieFromBackupMeter()}},{key:"loadCookieFromBackupMeter",value:function(){var e=this;o.pingBackupMeter(),setTimeout(function(){e.checkMeter()},1500)}},{key:"onUrlChange",value:function(){var e=n.cleanUrlFromQueryAndHashes();this.currentCleanUrl!==e&&(this.checkMeter({url:n.getLocation().href,referrer:this.currentCleanUrl}),this.currentCleanUrl=e)}},{key:"updateUserState",value:function(){return n.isNYT5Env()?!1:void e.ajax({dataType:"jsonp",url:this.meterSvc,data:{url:n.getLocation().href},success:function(t){t.loggedIn&&e("html").addClass("user-logged-in")}})}},{key:"loadGateway",value:function(a,i){var r=n.getLocation(),c=/&assetType=([^&]+)/.test(window.decodeURIComponent(r.search))?RegExp.$1:"",s=a||t||NYTD.Gateway,l=void 0;if(o["final"]=!0,e(document).trigger("NYTD:MeterFinal",o),o.pingBackupMeter(),s&&!i)l=new s(n.getGatewayType(),c),l.addCreative();else{var d=r.host.indexOf(".stg.")>0,u=d?"https://static.stg.nytimes.com":"https://static01.nyt.com",g=u+"/js/gwy.js";e.ajax({url:g,dataType:"script",success:function(){return l=new s(n.getGatewayType(),c)}})}return l}},{key:"checkMeter",value:function(t){var a=t||{url:n.getLocation().href,referrer:document.referrer};e(document).on("keydown",n.onEscapeKey),o.loaded=!1,this.get(a||{})}},{key:"get",value:function(t){var a=this,o=t.url||n.getLocation().href,i=null===t.referrer||void 0===t.referrer?n.getLocation().href:t.referrer;t.callback&&c.push(t.callback);var r=e("meta").filter('[name="channels"]').attr("content"),s="",l=void 0;"undefined"!=typeof r&&(s="&channels="+encodeURIComponent(r)),l=this.meterSvc+s,e.ajax({dataType:"jsonp",url:l,data:{url:o,referer:i},success:function(e){a.onMeterLoaded(e,t,o)}})}},{key:"onMeterLoaded",value:function(t,r,c,s){var l=void 0,d=s||a;if(t.isCookieValid===!1&&this.meterCookieBackupPriorityList.length>0){var u=this.meterCookieBackupPriorityList.pop();return u&&i.set("nyt-m",u,730),void this.get(r)}if(t.v&&t.v!==this.prevMeterCount&&(this.etTracker.meterCount=t.v,this.etTracker.trackMeterUpdate(t.v)),t.assetType&&(l=t.assetType),o.pingBackupMeter(),e("head").append('<meta name="WT.z_cad" content="'+(t.counted?"1":"0")+'" /> '),t.hitSoftPaywall){this.completeInitialization(t,c,l);var g=new d(o);return void g.initialize()}return parseInt(t.v,10)>parseInt(t.t,10)&&i.setOrRemoveMtrabCookie(t.ab),t.hitPaywall||t.hitRegiwall?void n.addGatewayHash(t.hash,t.hitPaywall,l):void this.completeInitialization(t,c,l)}},{key:"fillResponseObject",value:function(e,t,a,n){if(!e||!t)throw new Error("Please specify all required params.");var i=o.getMeterPagesCount(),r=n||o;return r.loaded=!0,r["final"]=!0,r.meterOn=e.meter,r.gatewayOn=e.gateway,r.hitPaypall=e.hitPaypall,r.hitRegiwall=e.hitRegiwall,r.cookieValid=e.isCookieValid,r.isLoggedIn=e.loggedIn,r.pageCount=i,r.url=t,r.assetType=a,r.counted=e.counted,r}},{key:"setUserLoggedInFlag",value:function(t){t.loggedIn&&e("html").addClass("user-logged-in")}},{key:"executeCallbacks",value:function(){e.each(c,function(e,t){t(o)}),c=[]}},{key:"triggerMeterHasBeenLoadedEvents",value:function(){e(document).trigger("NYTD:MeterLoaded",o),e(document).trigger("NYTD:MeterFinal",o)}},{key:"stopBlockingEscapeKey",value:function(){e(document).off("keydown",n.onEscapeKey)}},{key:"completeInitialization",value:function(e,t,a){this.fillResponseObject(e,t,a),this.setUserLoggedInFlag(e),this.executeCallbacks(),this.triggerMeterHasBeenLoadedEvents(),this.stopBlockingEscapeKey()}}],[{key:"getInstance",value:function(){return void 0===s&&(s=new o,s.constructor=null),s}},{key:"pingBackupMeter",value:function(){var t="https://meter-svc.nytimes.com/meter-echo.js?callback=?";e.ajax({dataType:"jsonp",url:t,jsonpCallback:"NYT_meterBackupCallback"})}},{key:"meterBackupCallback",value:function(e){return e&&"object"==typeof e&&e["nyt-m"]&&!i.get("nyt-m")?void i.set("nyt-m",e["nyt-m"],730):!1}},{key:"isErrorPage",value:function(){var e=document.getElementsByName("PST")[0],t=document.getElementsByTagName("title")[0],a=!1;return t&&t.innerHTML&&(a=/Page Not Found|Page unavailable/i.test(t.innerHTML)),!!(e&&e.content&&e.content.match(/error/i))||a}},{key:"getMeterPagesCount",value:function(){var e=o.processMeterCookie().match(/v=i\.([0-9]+)/);return e&&e[1]?parseInt(e[1],10):null}},{key:"processMeterCookie",value:function(){var e=i.get("nyt-m")||n.getFromLocalStorage("nyt-m")||window.name||"";return e&&(i.set("nyt-m",e,730),o.backupMeterCookie(e)),e}},{key:"backupMeterCookie",value:function(e){return e?(n.setToLocalStorage("nyt-m",e),void(window.name=e)):""}},{key:"getCookieHash",value:function(){var e=32;return o.processMeterCookie().substr(0,e)}}]),o}();return s=l.getInstance(),s.init(),l.check=s.checkMeter,l}),function(e){var t=function(e,t){var a=e.getInstance(),n="function"==typeof define&&define.amd?require("jquery/nyt"):NYTD.jQuery;n(document).on("NYTD:MeterLoaded",function(e,t){a.init(t)}),t&&t.loaded&&a.init(t)};"function"==typeof define&&define.amd?(define("ecomm/growl",["foundation/hosts","jquery/nyt","auth/mtr","foundation/views/page-manager","ecomm/utils","ecomm/logger","ecomm/url","ecomm/etTracker","ecomm/cookies","auth/gateway/creatives"],function(t,a,n,o,i,r,c,s,l,d){return e(t,a,n,o,i,r,c,s,l,d)}),setTimeout(function(){require(["ecomm/growl","auth/mtr"],function(e,a){t(e,a)})},0)):"object"==typeof NYTD&&(NYTD.AuthGrowl=e(NYTD.Hosts,NYTD.jQuery,NYTD.Meter,void 0,NYTD.Ecomm.Utils,NYTD.Ecomm.Logger,NYTD.Ecomm.Url,NYTD.Ecomm.EtTracker,NYTD.Ecomm.Cookies,NYTD.Ecomm.Creatives),t(NYTD.AuthGrowl,NYTD.Meter))}(function(e,t,a,n,o,i,r,c,s,l){var d=void 0,u=e.www||e.wwwHost,g=i.getInstance(),m=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"init",value:function(e){this.mtrData=e,this.addGrowl()}},{key:"addGrowl",value:function(){var e=this,a=this.mtrData,n=a.assetType,o="www.nytimes.com/growl",i=n&&""!==n?o+"_"+n:o,c=-1!==[5,9,10].indexOf(this.mtrData.pageCount)?!0:!1;if(this.close(),!(g.isDebugMode()||a.gatewayOn&&a.meterOn&&a.counted))return!1;var s=function(e){return!(e&&e.ads&&e.ads.Left9||!c)};t.ajax({url:u+"/adx/bin/adxrun.html?jsonp=?",dataType:"jsonp",data:{v:3,page:i,positions:"Left9,data_country,data_currency,data1,data2,data3",keywords:r.getAdxKeywords(),type:"fastscript",debug:1&g.isDebugMode()},success:function(t){var a=void 0;a=s(t)?l.defaultGrowl:t,e.onGrowlLoaded(a)},error:function(){c&&e.onGrowlLoaded(l.defaultGrowl)}})}},{key:"setGrowlPosition",value:function(){if(!this.$container)return!1;var e=t("#masthead"),a=e.length?e.offset().left:0,n=this.$container.find("#growl-container");a>0?n.css("left",a):n.removeAttr("style")}},{key:"_getPageManager",value:function(){return n}},{key:"attachNYT5Handlers",value:function(){var e=this._getPageManager();return e?(this.setGrowlPosition(),e.listenTo(e,"nyt:page-resize",this.setGrowlPosition),e.listenTo(e,"nyt:page-ready",this.setGrowlPosition),!0):!1}},{key:"onGrowlLoaded",value:function(a){var n=this,i=this.mtrData.pageCount,r=t("body"),c=function(){return i!==parseInt(s.getMeterCookieCount(),10)};if(c())return!1;if(!a||!a.ads||!a.ads.Left9)return!1;var l=t("meta[name='PT']").attr("content");l=l?l.replace(/\s/g,""):"Article",this.$container&&this.$container.off("click").remove(),this.$container=t("<div class='mtr-growl-container'></div>");var d=o.appendAds(a,this.$container);r.append(this.$container);var u=this.$container;return this.attachNYT5Handlers(),e.setupTracking({adxCampaigns:d,pageType:l,$growlContainer:u,meterCount:i,callback:function(e){n.close(e)}}),a.isDefault&&this.processDefaultGrowl(i),t(document).trigger("NYTD:AuthGrowlLoaded",{count:i}),!0}},{key:"processDefaultGrowl",value:function(e){var a=t("#growl-container"),n=t("#growl-login"),o=e,i={5:'You have read <span class="bold">5 of 10 free articles</span> this month.',9:'You have read <span class="bold">9 of 10 free articles</span> this month.',10:'This is your <span class="bold">last free article</span> this month.'};t(".growl_art").replaceWith(i[o]),t("#growl-cta"+o).addClass("show-cta"),setTimeout(function(){a.addClass("show-growl")},1e3),t("html").hasClass("user-logged-in")||n.show(),-1!==["5","9","10"].indexOf(o)&&t("#growl-container").addClass("meter-"+o);var r=function(e){a.animate({marginBottom:e,duration:200},{queue:!1})};5!==o&&(t(".nytdGrowlUIContainer").trigger("growl.expandable"),t("#growl-container").css("margin-bottom","0"),setTimeout(function(){r("-179px")},3e3),a.on("mouseenter",function(){r("0")}),a.on("mouseleave",function(){r("-179px")})),t("#growl-btn"+o).addClass("show-cta")}},{key:"close",value:function(e){var t=this;return this.$container?(this.$container.fadeOut("slow",function(){t.$container&&(t.$container.unbind("click"),t.$container.remove())}),void(e&&e.preventDefault())):!1}}],[{key:"getInstance",value:function(){return void 0===d&&(d=new e,d.constructor=null),d}},{key:"isGrowlAdxCampaign",value:function(e){return o.checkStringWithRegexp("growl",e)}},{key:"isInterstitialAdxCampaign",value:function(e){return o.checkStringWithRegexp("interstitial",e)}},{key:"setupTracking",value:function(t){var a=void 0,n={$container:t.$growlContainer,module:"Growl",region:"FixedBottom",adxCampaignName:t.adxCampaigns,meterCount:t.meterCount,trackingParams:{expand:{eventName:"adExpansion",action:"hover"}},moduleInteractions:[{selector:".nytdGrowlNotifyCross",action:"click",tagxEvent:"growl-close",etParamKey:"close",callback:t.callback}]},i={$container:t.$growlContainer,module:"Interstitial",region:"FixedCenter",pgtype:t.pageType,adxCampaignName:t.adxCampaigns,meterCount:t.meterCount,moduleInteractions:[{selector:".nytdGrowlNotifyCross",action:"click",tagxEvent:"interstitial-close",etParamKey:"close",callback:t.callback}]};e.isGrowlAdxCampaign(t.adxCampaigns)?(a=new c(n),t.$growlContainer.on("growl.expandable",function(){t.$growlContainer.on("mouseenter",o.debounce(function(){a.track("growl-expand","expand")},300)).off("growl.expandable")})):e.isInterstitialAdxCampaign(t.adxCampaigns)&&(a=new c(i)),this.etTracker=a}}]),e}();return m});